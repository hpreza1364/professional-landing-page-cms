<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุฏฺฏ ูพุฌ ุญุฑููโุง ุจุง CMS</title>
    <link rel="icon" type="image/x-icon" id="dynamicFavicon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>๐ข</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/components/navigation.css">
    <link rel="stylesheet" href="./css/components/cms-panel.css">
    <link rel="stylesheet" href="./css/components/sections.css">
    <link rel="stylesheet" href="./css/components/modals.css">
    <link rel="stylesheet" href="./css/components/responsive.css">
</head>
<body>
    <!-- Navigation -->
    <div class="fixed-nav">
        <div class="nav-logo">
            <img id="navLogo" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>๐ข</text></svg>" alt="ููฺฏู">
        </div>
        <div class="nav-container" id="navContainer"></div>
    </div>
    
    <!-- CMS Controls -->
    <div class="cms-toggle" id="cmsToggle">
        <i class="fas fa-cog"></i>
    </div>
    
    <div class="cms-controls" id="cmsControls">
        <div class="cms-section">
            <h3><i class="fas fa-palette"></i> ุชูุธูุงุช ุธุงูุฑ</h3>
            <div class="cms-control">
                <label>ุฑูฺฏ ุงุตู</label>
                <div class="color-picker">
                    <input type="color" id="primaryColor" value="#3498db">
                    <input type="text" id="primaryColorText" value="#3498db">
                </div>
            </div>
            <div class="cms-control">
                <label>ุฑูฺฏ ุซุงููู</label>
                <div class="color-picker">
                    <input type="color" id="secondaryColor" value="#2c3e50">
                    <input type="text" id="secondaryColorText" value="#2c3e50">
                </div>
            </div>
            <div class="cms-control">
                <label>ุฑูฺฏ ุฏฺฉููโูุง</label>
                <div class="color-picker">
                    <input type="color" id="buttonColor" value="#e74c3c">
                    <input type="text" id="buttonColorText" value="#e74c3c">
                </div>
            </div>
            <div class="cms-control">
                <label>ุชุฑุงุฒ ูุชู</label>
                <div class="alignment-controls">
                    <div class="alignment-btn active" data-align="right">ุฑุงุณุช</div>
                    <div class="alignment-btn" data-align="center">ูุณุท</div>
                    <div class="alignment-btn" data-align="left">ฺูพ</div>
                </div>
            </div>
            <div class="cms-control">
                <button id="applyTheme">ุงุนูุงู ุชุบุฑุงุช</button>
            </div>
        </div>
        
        <div class="cms-section">
            <h3><i class="fas fa-image"></i> ุชุตูุฑ ูพุณโุฒููู</h3>
            <div class="cms-control">
                <input type="file" id="bgImageUpload" accept="image/*">
                <button id="applyBgImage">ุงุนูุงู ุชุตูุฑ</button>
            </div>
        </div>
        
        <div class="cms-section">
            <h3><i class="fas fa-download"></i> ุฐุฎุฑู ู ุจุงุฒุงุจ</h3>
            <div class="cms-control">
                <button id="saveData">ุฐุฎุฑู ุชูุธูุงุช</button>
            </div>
            <div class="cms-control">
                <button id="saveHTML">ุฐุฎุฑู ุจู ุตูุฑุช HTML</button>
            </div>
            <div class="cms-control">
                <input type="file" id="loadData" accept=".json">
                <button id="importData">ุจุงุฑฺฏุฐุงุฑ ุชูุธูุงุช</button>
            </div>
        </div>
    </div>
    
    <!-- Main Content Container -->
    <div class="main-container" id="mainContainer">
        <!-- Hero Section -->
        <section class="hero-section" id="section-hero" data-section="hero">
            <img class="hero-bg" id="heroBg" src="" alt="ูพุณโุฒููู">
            <div class="hero-content">
                <div class="business-info">
                    <div class="logo-container" id="logoContainer">
                        <img id="businessLogo" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>๐ข</text></svg>" alt="ููฺฏู ฺฉุณุจโูฺฉุงุฑ">
                        <div class="logo-upload-text">ุจุฑุง ุชุบุฑ ููฺฏู ฺฉูฺฉ ฺฉูุฏ</div>
                    </div>
                    <div class="business-text">
                        <h1 contenteditable="true" class="editable" id="businessName">ูุงู ฺฉุณุจโูฺฉุงุฑ ุดูุง</h1>
                        <p contenteditable="true" class="editable" id="businessTagline">ุชูุถุญ ฺฉูุชุงู ุฏุฑุจุงุฑู ฺฉุณุจโูฺฉุงุฑ ุดูุง</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Add Section Button -->
    <div class="add-section-main" id="addSectionMain">
        <i class="fas fa-plus"></i>
    </div>
    
    <!-- Section Selection Modal -->
    <div class="section-modal" id="sectionModal">
        <div class="section-modal-content">
            <div class="section-modal-header">
                <h2>ุงูุฒูุฏู ุจุฎุด ุฌุฏุฏ</h2>
                <div class="section-modal-close" id="sectionModalClose">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="section-options">
                <div class="section-option" data-type="about">
                    <i class="fas fa-info-circle"></i>
                    <span>ุฏุฑุจุงุฑู ูุง</span>
                </div>
                <div class="section-option" data-type="services">
                    <i class="fas fa-concierge-bell"></i>
                    <span>ุฎุฏูุงุช</span>
                </div>
                <div class="section-option" data-type="testimonials">
                    <i class="fas fa-comment-alt"></i>
                    <span>ูุธุฑุงุช ูุดุชุฑุงู</span>
                </div>
                <div class="section-option" data-type="gallery">
                    <i class="fas fa-images"></i>
                    <span>ฺฏุงูุฑ ุชุตุงูุฑ</span>
                </div>
                <div class="section-option" data-type="social">
                    <i class="fas fa-share-alt"></i>
                    <span>ุดุจฺฉูโูุง ุงุฌุชูุงุน</span>
                </div>
                <div class="section-option" data-type="banking">
                    <i class="fas fa-credit-card"></i>
                    <span>ุงุทูุงุนุงุช ุจุงูฺฉ</span>
                </div>
                <div class="section-option" data-type="contact">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>ุชูุงุณ ู ููุดู</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Social Media Selection Modal -->
    <div class="social-modal" id="socialModal">
        <div class="social-modal-content">
            <div class="social-modal-header">
                <h2>ุงูุฒูุฏู ุดุจฺฉู ุงุฌุชูุงุน</h2>
                <div class="social-modal-close" id="socialModalClose">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="social-options">
                <div class="social-option" data-platform="instagram">
                    <i class="fab fa-instagram"></i>
                    <span>ุงูุณุชุงฺฏุฑุงู</span>
                </div>
                <div class="social-option" data-platform="telegram">
                    <i class="fab fa-telegram"></i>
                    <span>ุชูฺฏุฑุงู</span>
                </div>
                <div class="social-option" data-platform="whatsapp">
                    <i class="fab fa-whatsapp"></i>
                    <span>ูุงุชุณุงูพ</span>
                </div>
                <div class="social-option" data-platform="twitter">
                    <i class="fab fa-twitter"></i>
                    <span>ุชูุชุฑ</span>
                </div>
                <div class="social-option" data-platform="linkedin">
                    <i class="fab fa-linkedin"></i>
                    <span>ููฺฉุฏู</span>
                </div>
                <div class="social-option" data-platform="youtube">
                    <i class="fab fa-youtube"></i>
                    <span>ูุชูุจ</span>
                </div>
            </div>
            <div class="social-input">
                <input type="text" id="socialUsername" placeholder="ูุงู ฺฉุงุฑุจุฑ ุง ุขุฏุฑุณ">
                <button id="addSocialConfirm">ุงูุฒูุฏู</button>
            </div>
        </div>
    </div>
    
    <!-- Lightbox for Gallery -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-close" id="lightboxClose">
            <i class="fas fa-times"></i>
        </div>
        <div class="lightbox-nav">
            <button id="lightboxPrev"><i class="fas fa-chevron-right"></i></button>
            <button id="lightboxNext"><i class="fas fa-chevron-left"></i></button>
        </div>
        <div class="lightbox-content">
            <img id="lightboxImage" src="" alt="ุชุตูุฑ ุจุฒุฑฺฏโุดุฏู">
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <!-- Hidden file input for logo upload -->
    <input type="file" id="logoUpload" accept="image/*" style="display: none;">
    
    <!-- Hidden file input for gallery upload -->
    <input type="file" id="galleryUpload" accept="image/*" multiple style="display: none;">
    
    <!-- Hidden file input for about image upload -->
    <input type="file" id="aboutImageUpload" accept="image/*" style="display: none;">

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- All JavaScript in one file -->
    <script>
        // Global variables
        let sections = [];
        let currentSectionType = '';
        let currentSocialPlatform = '';
        let galleryImages = [];
        let currentGalleryIndex = 0;
        let maps = new Map(); // ุจุฑุง ุฐุฎุฑู ููุดูโูุง
        
        // DOM elements
        const cmsToggle = document.getElementById('cmsToggle');
        const cmsControls = document.getElementById('cmsControls');
        const mainContainer = document.getElementById('mainContainer');
        const addSectionMain = document.getElementById('addSectionMain');
        const sectionModal = document.getElementById('sectionModal');
        const sectionModalClose = document.getElementById('sectionModalClose');
        const sectionOptions = document.querySelectorAll('.section-option');
        const socialModal = document.getElementById('socialModal');
        const socialModalClose = document.getElementById('socialModalClose');
        const socialOptions = document.querySelectorAll('.social-option');
        const addSocialConfirm = document.getElementById('addSocialConfirm');
        const socialUsername = document.getElementById('socialUsername');
        const lightbox = document.getElementById('lightbox');
        const lightboxClose = document.getElementById('lightboxClose');
        const lightboxImage = document.getElementById('lightboxImage');
        const lightboxPrev = document.getElementById('lightboxPrev');
        const lightboxNext = document.getElementById('lightboxNext');
        const logoUpload = document.getElementById('logoUpload');
        const logoContainer = document.getElementById('logoContainer');
        const businessLogo = document.getElementById('businessLogo');
        const navLogo = document.getElementById('navLogo');
        const galleryUpload = document.getElementById('galleryUpload');
        const aboutImageUpload = document.getElementById('aboutImageUpload');
        const navContainer = document.getElementById('navContainer');
        const dynamicFavicon = document.getElementById('dynamicFavicon');
        const toast = document.getElementById('toast');
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded successfully!');
            
            // Load saved data if available
            loadSavedData();
            
            // Initialize navigation
            updateNavigation();
            
            // Event listeners
            cmsToggle.addEventListener('click', toggleCMS);
            addSectionMain.addEventListener('click', openSectionModal);
            sectionModalClose.addEventListener('click', closeSectionModal);
            socialModalClose.addEventListener('click', closeSocialModal);
            lightboxClose.addEventListener('click', closeLightbox);
            lightboxPrev.addEventListener('click', showPrevImage);
            lightboxNext.addEventListener('click', showNextImage);
            logoContainer.addEventListener('click', () => logoUpload.click());
            logoUpload.addEventListener('change', handleLogoUpload);
            
            // Section selection
            sectionOptions.forEach(option => {
                option.addEventListener('click', function() {
                    currentSectionType = this.getAttribute('data-type');
                    addSection(currentSectionType);
                    closeSectionModal();
                });
            });
            
            // Social platform selection
            socialOptions.forEach(option => {
                option.addEventListener('click', function() {
                    socialOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    currentSocialPlatform = this.getAttribute('data-platform');
                });
            });
            
            // Add social media
            addSocialConfirm.addEventListener('click', addSocialMedia);
            
            // Theme controls
            document.getElementById('applyTheme').addEventListener('click', applyTheme);
            document.getElementById('applyBgImage').addEventListener('click', applyBackgroundImage);
            document.getElementById('saveData').addEventListener('click', saveData);
            document.getElementById('saveHTML').addEventListener('click', saveHTML);
            document.getElementById('importData').addEventListener('click', importData);
            
            // Color picker synchronization
            document.getElementById('primaryColor').addEventListener('input', function() {
                document.getElementById('primaryColorText').value = this.value;
            });
            document.getElementById('primaryColorText').addEventListener('input', function() {
                document.getElementById('primaryColor').value = this.value;
            });
            
            document.getElementById('secondaryColor').addEventListener('input', function() {
                document.getElementById('secondaryColorText').value = this.value;
            });
            document.getElementById('secondaryColorText').addEventListener('input', function() {
                document.getElementById('secondaryColor').value = this.value;
            });
            
            document.getElementById('buttonColor').addEventListener('input', function() {
                document.getElementById('buttonColorText').value = this.value;
            });
            document.getElementById('buttonColorText').addEventListener('input', function() {
                document.getElementById('buttonColor').value = this.value;
            });
            
            // Text alignment controls
            document.querySelectorAll('.alignment-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.alignment-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const alignment = this.getAttribute('data-align');
                    document.documentElement.style.setProperty('--text-align', alignment);
                    
                    // Update navigation layout based on alignment
                    updateNavLayout(alignment);
                });
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === sectionModal) {
                    closeSectionModal();
                }
                if (event.target === socialModal) {
                    closeSocialModal();
                }
                if (event.target === lightbox) {
                    closeLightbox();
                }
            });
            
            // Initialize Sortable for drag and drop
            initSortable();

            // Handle gallery upload
            galleryUpload.addEventListener('change', handleGalleryUpload);

            console.log('All event listeners initialized!');
        });
        
        // Update navigation layout based on text alignment
        function updateNavLayout(alignment) {
            const fixedNav = document.querySelector('.fixed-nav');
            
            if (alignment === 'right') {
                // RTL layout - logo on the right
                document.documentElement.style.setProperty('--nav-direction', 'row');
                document.documentElement.style.setProperty('--logo-order', '1');
                document.documentElement.style.setProperty('--nav-items-order', '0');
                fixedNav.style.flexDirection = 'row';
            } else if (alignment === 'left') {
                // LTR layout - logo on the left
                document.documentElement.style.setProperty('--nav-direction', 'row');
                document.documentElement.style.setProperty('--logo-order', '0');
                document.documentElement.style.setProperty('--nav-items-order', '1');
                fixedNav.style.flexDirection = 'row';
            } else {
                // Center alignment - logo above nav items
                document.documentElement.style.setProperty('--nav-direction', 'column');
                document.documentElement.style.setProperty('--logo-order', '0');
                document.documentElement.style.setProperty('--nav-items-order', '1');
                fixedNav.style.flexDirection = 'column';
            }
        }
        
        // Toggle CMS controls panel
        function toggleCMS() {
            cmsControls.classList.toggle('active');
            mainContainer.classList.toggle('cms-open');
            showToast('ูพูู ูุฏุฑุช ' + (cmsControls.classList.contains('active') ? 'ุจุงุฒ' : 'ุจุณุชู') + ' ุดุฏ');
        }
        
        // Open section selection modal
        function openSectionModal() {
            sectionModal.classList.add('active');
            showToast('ููู ุงูุฒูุฏู ุจุฎุด ุจุงุฒ ุดุฏ');
        }
        
        // Close section selection modal
        function closeSectionModal() {
            sectionModal.classList.remove('active');
        }
        
        // Open social media selection modal
        function openSocialModal() {
            socialModal.classList.add('active');
        }
        
        // Close social media selection modal
        function closeSocialModal() {
            socialModal.classList.remove('active');
            socialOptions.forEach(opt => opt.classList.remove('active'));
            socialUsername.value = '';
            currentSocialPlatform = '';
        }
        
        // Open lightbox
        function openLightbox(index) {
            currentGalleryIndex = index;
            lightboxImage.src = galleryImages[index].src;
            lightbox.classList.add('show');
        }
        
        // Close lightbox
        function closeLightbox() {
            lightbox.classList.remove('show');
        }
        
        // Show previous image in lightbox
        function showPrevImage() {
            currentGalleryIndex = (currentGalleryIndex - 1 + galleryImages.length) % galleryImages.length;
            lightboxImage.src = galleryImages[currentGalleryIndex].src;
        }
        
        // Show next image in lightbox
        function showNextImage() {
            currentGalleryIndex = (currentGalleryIndex + 1) % galleryImages.length;
            lightboxImage.src = galleryImages[currentGalleryIndex].src;
        }
        
        // Handle logo upload
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                compressImage(file, 300, function(compressedDataUrl) {
                    businessLogo.src = compressedDataUrl;
                    navLogo.src = compressedDataUrl;
                    dynamicFavicon.href = compressedDataUrl;
                    
                    // Save to localStorage
                    localStorage.setItem('businessLogo', compressedDataUrl);
                    
                    showToast('ููฺฏู ุจุง ููููุช ุชุบุฑ ฺฉุฑุฏ');
                });
            }
            event.target.value = '';
        }

        // Handle gallery upload
        function handleGalleryUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                let processedCount = 0;
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    compressImage(file, 300, function(compressedDataUrl) {
                        addGalleryImage(compressedDataUrl);
                        processedCount++;
                        
                        if (processedCount === files.length) {
                            showToast(`${files.length} ุชุตูุฑ ุจู ฺฏุงูุฑ ุงุถุงูู ุดุฏ`);
                        }
                    });
                }
            }
            event.target.value = '';
        }
        
        // Add a new section
        function addSection(type) {
            const sectionId = 'section-' + Date.now();
            let sectionHTML = '';
            
            switch(type) {
                case 'about':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="about">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">ุฏุฑุจุงุฑู ูุง</div>
                                <div class="delete-section" data-section-id="${sectionId}">ุญุฐู</div>
                            </div>
                            <div class="about-content">
                                <div class="about-image" id="aboutImage-${sectionId}">
                                    <i class="fas fa-image" style="font-size: 48px; opacity: 0.5;"></i>
                                    <div class="image-upload-text">ุจุฑุง ุชุบุฑ ุชุตูุฑ ฺฉูฺฉ ฺฉูุฏ</div>
                                </div>
                                <div class="about-text">
                                    <p contenteditable="true">ุฏุฑ ุงู ุจุฎุด ูโุชูุงูุฏ ุงุทูุงุนุงุช ุฏุฑุจุงุฑู ฺฉุณุจโูฺฉุงุฑ ุฎูุฏ ุงุฑุงุฆู ุฏูุฏ. ุชุงุฑุฎฺูุ ูุงููุฑุชุ ฺุดูโุงูุฏุงุฒ ู ุงุฑุฒุดโูุง ุดุฑฺฉุช ุฎูุฏ ุฑุง ุฏุฑ ุงูุฌุง ุดุฑุญ ุฏูุฏ.</p>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'services':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="services">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">ุฎุฏูุงุช ูุง</div>
                                <div class="delete-section" data-section-id="${sectionId}">ุญุฐู</div>
                            </div>
                            <div class="services-grid">
                                <div class="service-card">
                                    <h3 contenteditable="true">ุฎุฏูุงุช ูุดุงูุฑู</h3>
                                    <p contenteditable="true">ุชูุถุญ ูุฎุชุตุฑ ุฏุฑุจุงุฑู ุงู ุฎุฏูุช ุงุฑุงุฆู ุฏูุฏ.</p>
                                </div>
                                <div class="service-card">
                                    <h3 contenteditable="true">ุทุฑุงุญ ู ุชูุณุนู</h3>
                                    <p contenteditable="true">ุชูุถุญ ูุฎุชุตุฑ ุฏุฑุจุงุฑู ุงู ุฎุฏูุช ุงุฑุงุฆู ุฏูุฏ.</p>
                                </div>
                                <div class="service-card">
                                    <h3 contenteditable="true">ูพุดุชุจุงู</h3>
                                    <p contenteditable="true">ุชูุถุญ ูุฎุชุตุฑ ุฏุฑุจุงุฑู ุงู ุฎุฏูุช ุงุฑุงุฆู ุฏูุฏ.</p>
                                </div>
                                <div class="add-service-btn" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>ุงูุฒูุฏู ุฎุฏูุช ุฌุฏุฏ</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'testimonials':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="testimonials">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">ูุธุฑุงุช ูุดุชุฑุงู</div>
                                <div class="delete-section" data-section-id="${sectionId}">ุญุฐู</div>
                            </div>
                            <div class="testimonials-grid">
                                <div class="testimonial-card">
                                    <p contenteditable="true">"ุงู ุดุฑฺฉุช ุฎุฏูุงุช ูููโุงูุนุงุฏูโุง ุงุฑุงุฆู ูโุฏูุฏ. ูู ุจุณุงุฑ ุฑุงุถ ูุณุชู ู ุจู ุฏฺฏุฑุงู ูุฒ ุชูุตู ูโฺฉูู."</p>
                                    <div class="client" contenteditable="true">- ูุญูุฏ ุฑุถุง</div>
                                </div>
                                <div class="testimonial-card">
                                    <p contenteditable="true">"ูพุดุชุจุงู ุนุงู ู ุฎุฏูุงุช ุจุง ฺฉูุช. ุญุชูุงู ููฺฉุงุฑ ุฎูุงูู ฺฉุฑุฏ."</p>
                                    <div class="client" contenteditable="true">- ูุงุทูู ูุญูุฏ</div>
                                </div>
                                <div class="add-testimonial-btn" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>ุงูุฒูุฏู ูุธุฑ ุฌุฏุฏ</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'gallery':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="gallery">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">ฺฏุงูุฑ ุชุตุงูุฑ</div>
                                <div class="delete-section" data-section-id="${sectionId}">ุญุฐู</div>
                            </div>
                            <div class="gallery-grid">
                                <div class="add-gallery-item" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>ุงูุฒูุฏู ุชุตูุฑ</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'social':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="social">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">ุดุจฺฉูโูุง ุงุฌุชูุงุน</div>
                                <div class="delete-section" data-section-id="${sectionId}">ุญุฐู</div>
                            </div>
                            <div class="social-grid">
                                <div class="add-social-btn" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>ุงูุฒูุฏู ุดุจฺฉู ุงุฌุชูุงุน</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'banking':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="banking">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">ุงุทูุงุนุงุช ุจุงูฺฉ</div>
                                <div class="delete-section" data-section-id="${sectionId}">ุญุฐู</div>
                            </div>
                            <div class="banking-grid">
                                <div class="banking-card">
                                    <div class="bank-icon">
                                        <i class="fas fa-university"></i>
                                    </div>
                                    <div class="bank-info">
                                        <div contenteditable="true">ุจุงูฺฉ ูู</div>
                                        <div class="bank-number" contenteditable="true">6037-9910-1234-5678</div>
                                    </div>
                                    <div class="bank-delete">
                                        <i class="fas fa-times"></i>
                                    </div>
                                </div>
                                <div class="add-banking-btn" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>ุงูุฒูุฏู ุญุณุงุจ ุจุงูฺฉ</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'contact':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="contact">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">ุชูุงุณ ุจุง ูุง</div>
                                <div class="delete-section" data-section-id="${sectionId}">ุญุฐู</div>
                            </div>
                            <div class="contact-map-section">
                                <div class="contact-grid">
                                    <div class="contact-item">
                                        <div class="contact-icon">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </div>
                                        <div class="contact-info">
                                            <h3 contenteditable="true">ุขุฏุฑุณ</h3>
                                            <p contenteditable="true">ุชูุฑุงูุ ุฎุงุจุงู ููุนุตุฑุ ฺฉูฺู ููุงูุ ูพูุงฺฉ ฑฒณ</p>
                                        </div>
                                    </div>
                                    
                                    <!-- ุชูููโูุง -->
                                    <div class="contact-items-group">
                                        <div class="contact-group-header">
                                            <h3>ุชูููโูุง ุชูุงุณ</h3>
                                            <button class="add-contact-item-btn" data-type="phone">
                                                <i class="fas fa-plus"></i> ุงูุฒูุฏู ุชููู
                                            </button>
                                        </div>
                                        <div class="contact-items-list" data-type="phone">
                                            <div class="contact-item">
                                                <div class="contact-icon">
                                                    <i class="fas fa-phone"></i>
                                                </div>
                                                <div class="contact-info">
                                                    <div contenteditable="true" class="contact-label">ุชููู ุงุตู</div>
                                                    <p contenteditable="true">ฐฒฑ-ฑฒณดตถทธ</p>
                                                </div>
                                                <div class="contact-item-delete">
                                                    <i class="fas fa-times"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- ุงููโูุง -->
                                    <div class="contact-items-group">
                                        <div class="contact-group-header">
                                            <h3>ุขุฏุฑุณโูุง ุงูู</h3>
                                            <button class="add-contact-item-btn" data-type="email">
                                                <i class="fas fa-plus"></i> ุงูุฒูุฏู ุงูู
                                            </button>
                                        </div>
                                        <div class="contact-items-list" data-type="email">
                                            <div class="contact-item">
                                                <div class="contact-icon">
                                                    <i class="fas fa-envelope"></i>
                                                </div>
                                                <div class="contact-info">
                                                    <div contenteditable="true" class="contact-label">ุงูู ุงุตู</div>
                                                    <p contenteditable="true">info@example.com</p>
                                                </div>
                                                <div class="contact-item-delete">
                                                    <i class="fas fa-times"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="map-container">
                                    <div class="map-instructions">
                                        <i class="fas fa-info-circle"></i>
                                        ุจุฑุง ุชุบุฑ ูููุนุช ุฑู ููุดู ฺฉูฺฉ ฺฉูุฏ
                                    </div>
                                    <div id="map-${sectionId}" class="real-map"></div>
                                    <div class="map-controls">
                                        <input type="text" id="mapSearch-${sectionId}" placeholder="ุฌุณุชุฌู ุขุฏุฑุณ (ูุซุงู: ุชูุฑุงูุ ูุฏุงู ุขุฒุงุฏ)">
                                        <button class="search-map-btn" data-section-id="${sectionId}">ุฌุณุชุฌู</button>
                                        <button class="reset-map-btn" data-section-id="${sectionId}">ูููุนุช ูพุดโูุฑุถ</button>
                                    </div>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
            }
            
            // Add section to the page
            mainContainer.insertAdjacentHTML('beforeend', sectionHTML);
            
            // Add event listeners to the new section
            setTimeout(() => {
                const newSection = document.getElementById(sectionId);
                
                // Delete button
                const deleteBtn = newSection.querySelector('.delete-section');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function() {
                        deleteSection(sectionId);
                    });
                }
                
                // Add service button
                const addServiceBtn = newSection.querySelector('.add-service-btn');
                if (addServiceBtn) {
                    addServiceBtn.addEventListener('click', function() {
                        addServiceCard(sectionId);
                    });
                }
                
                // Add testimonial button
                const addTestimonialBtn = newSection.querySelector('.add-testimonial-btn');
                if (addTestimonialBtn) {
                    addTestimonialBtn.addEventListener('click', function() {
                        addTestimonialCard(sectionId);
                    });
                }
                
                // Add social button
                const addSocialBtn = newSection.querySelector('.add-social-btn');
                if (addSocialBtn) {
                    addSocialBtn.addEventListener('click', function() {
                        openSocialModal();
                    });
                }
                
                // Add gallery button
                const addGalleryBtn = newSection.querySelector('.add-gallery-item');
                if (addGalleryBtn) {
                    addGalleryBtn.addEventListener('click', function() {
                        galleryUpload.click();
                    });
                }
                
                // Add banking button
                const addBankingBtn = newSection.querySelector('.add-banking-btn');
                if (addBankingBtn) {
                    addBankingBtn.addEventListener('click', function() {
                        addBankCard(sectionId);
                    });
                }
                
                // Bank delete buttons
                const bankDeleteBtns = newSection.querySelectorAll('.bank-delete');
                bankDeleteBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        deleteBankCard(this);
                    });
                });
                
                // Bank number copy
                const bankNumbers = newSection.querySelectorAll('.bank-number');
                bankNumbers.forEach(number => {
                    number.addEventListener('click', function() {
                        copyToClipboard(this);
                    });
                });
                
                // About image upload
                if (type === 'about') {
                    const aboutImage = document.getElementById(`aboutImage-${sectionId}`);
                    aboutImage.addEventListener('click', function() {
                        aboutImageUpload.click();
                    });
                }
                
                // Contact section specific event listeners
                if (type === 'contact') {
                    // Add phone button
                    const addPhoneBtn = newSection.querySelector('.add-contact-item-btn[data-type="phone"]');
                    if (addPhoneBtn) {
                        addPhoneBtn.addEventListener('click', function() {
                            addContactItem(sectionId, 'phone');
                        });
                    }
                    
                    // Add email button
                    const addEmailBtn = newSection.querySelector('.add-contact-item-btn[data-type="email"]');
                    if (addEmailBtn) {
                        addEmailBtn.addEventListener('click', function() {
                            addContactItem(sectionId, 'email');
                        });
                    }
                    
                    // Contact item delete buttons
                    const contactDeleteBtns = newSection.querySelectorAll('.contact-item-delete');
                    contactDeleteBtns.forEach(btn => {
                        btn.addEventListener('click', function() {
                            deleteContactItem(this);
                        });
                    });
                    
                    // Initialize map
                    setTimeout(() => {
                        initMap(sectionId);
                    }, 500);
                    
                    // Map search button
                    const mapSearchBtn = newSection.querySelector('.search-map-btn');
                    if (mapSearchBtn) {
                        mapSearchBtn.addEventListener('click', function() {
                            searchAddress(sectionId);
                        });
                    }
                    
                    // Map reset button
                    const resetMapBtn = newSection.querySelector('.reset-map-btn');
                    if (resetMapBtn) {
                        resetMapBtn.addEventListener('click', function() {
                            resetMap(sectionId);
                        });
                    }
                }
            }, 100);
            
            // Add section to sections array
            sections.push({
                id: sectionId,
                type: type,
                title: '',
                content: ''
            });
            
            // Update navigation
            updateNavigation();
            
            showToast(`ุจุฎุด "${getSectionTypeName(type)}" ุจุง ููููุช ุงุถุงูู ุดุฏ`);
        }
        
        // Get section type name in Persian
        function getSectionTypeName(type) {
            const names = {
                'about': 'ุฏุฑุจุงุฑู ูุง',
                'services': 'ุฎุฏูุงุช',
                'testimonials': 'ูุธุฑุงุช ูุดุชุฑุงู',
                'gallery': 'ฺฏุงูุฑ ุชุตุงูุฑ',
                'social': 'ุดุจฺฉูโูุง ุงุฌุชูุงุน',
                'banking': 'ุงุทูุงุนุงุช ุจุงูฺฉ',
                'contact': 'ุชูุงุณ ู ููุดู'
            };
            
            return names[type] || type;
        }
        
        // Delete a section
        function deleteSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                // Remove map if exists
                if (maps.has(sectionId)) {
                    const map = maps.get(sectionId);
                    map.remove();
                    maps.delete(sectionId);
                }
                
                section.remove();
                
                // Remove from sections array
                sections = sections.filter(section => section.id !== sectionId);
                
                // Update navigation
                updateNavigation();
                
                showToast('ุจุฎุด ุจุง ููููุช ุญุฐู ุดุฏ');
            }
        }
        
        // Add a service card
        function addServiceCard(sectionId) {
            const servicesGrid = document.querySelector(`#${sectionId} .services-grid`);
            const addButton = servicesGrid.querySelector('.add-service-btn');
            
            const serviceCard = document.createElement('div');
            serviceCard.className = 'service-card';
            serviceCard.innerHTML = `
                <h3 contenteditable="true">ุฎุฏูุช ุฌุฏุฏ</h3>
                <p contenteditable="true">ุชูุถุญ ูุฎุชุตุฑ ุฏุฑุจุงุฑู ุงู ุฎุฏูุช ุงุฑุงุฆู ุฏูุฏ.</p>
            `;
            
            servicesGrid.insertBefore(serviceCard, addButton);
            showToast('ุฎุฏูุช ุฌุฏุฏ ุจุง ููููุช ุงุถุงูู ุดุฏ');
        }
        
        // Add a testimonial card
        function addTestimonialCard(sectionId) {
            const testimonialsGrid = document.querySelector(`#${sectionId} .testimonials-grid`);
            const addButton = testimonialsGrid.querySelector('.add-testimonial-btn');
            
            const testimonialCard = document.createElement('div');
            testimonialCard.className = 'testimonial-card';
            testimonialCard.innerHTML = `
                <p contenteditable="true">"ูุธุฑ ุฌุฏุฏ ูุดุชุฑ"</p>
                <div class="client" contenteditable="true">- ูุงู ูุดุชุฑ</div>
            `;
            
            testimonialsGrid.insertBefore(testimonialCard, addButton);
            showToast('ูุธุฑ ุฌุฏุฏ ุจุง ููููุช ุงุถุงูู ุดุฏ');
        }
        
        // Add social media
        function addSocialMedia() {
            if (!currentSocialPlatform || !socialUsername.value) {
                showToast('ูุทูุงู ฺฉ ูพูุชูุฑู ู ูุงู ฺฉุงุฑุจุฑ ูุงุฑุฏ ฺฉูุฏ');
                return;
            }
            
            const socialSections = document.querySelectorAll('[data-section="social"]');
            if (socialSections.length === 0) {
                showToast('ูุทูุงู ุงุจุชุฏุง ุจุฎุด ุดุจฺฉูโูุง ุงุฌุชูุงุน ุฑุง ุงุถุงูู ฺฉูุฏ');
                return;
            }
            
            const socialGrid = socialSections[0].querySelector('.social-grid');
            const addButton = socialGrid.querySelector('.add-social-btn');
            
            const socialCard = document.createElement('div');
            socialCard.className = 'social-card';
            socialCard.innerHTML = `
                <div class="social-icon">
                    <i class="fab fa-${currentSocialPlatform}"></i>
                </div>
                <div>
                    <div contenteditable="true">${getSocialPlatformName(currentSocialPlatform)}</div>
                    <div class="social-username">${socialUsername.value}</div>
                </div>
                <div class="social-delete">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            socialGrid.insertBefore(socialCard, addButton);
            
            // Add event listeners to the new social card
            const socialDeleteBtn = socialCard.querySelector('.social-delete');
            socialDeleteBtn.addEventListener('click', function() {
                deleteSocialCard(this);
            });
            
            closeSocialModal();
            showToast('ุดุจฺฉู ุงุฌุชูุงุน ุจุง ููููุช ุงุถุงูู ุดุฏ');
        }
        
        // Get social platform name in Persian
        function getSocialPlatformName(platform) {
            const names = {
                'instagram': 'ุงูุณุชุงฺฏุฑุงู',
                'telegram': 'ุชูฺฏุฑุงู',
                'whatsapp': 'ูุงุชุณุงูพ',
                'twitter': 'ุชูุชุฑ',
                'linkedin': 'ููฺฉุฏู',
                'youtube': 'ูุชูุจ'
            };
            
            return names[platform] || platform;
        }
        
        // Delete social media card
        function deleteSocialCard(element) {
            element.parentElement.remove();
            showToast('ุดุจฺฉู ุงุฌุชูุงุน ุจุง ููููุช ุญุฐู ุดุฏ');
        }
        
        // Add bank card
        function addBankCard(sectionId) {
            const bankingGrid = document.querySelector(`#${sectionId} .banking-grid`);
            const addButton = bankingGrid.querySelector('.add-banking-btn');
            
            const bankingCard = document.createElement('div');
            bankingCard.className = 'banking-card';
            bankingCard.innerHTML = `
                <div class="bank-icon">
                    <i class="fas fa-university"></i>
                </div>
                <div class="bank-info">
                    <div contenteditable="true">ูุงู ุจุงูฺฉ</div>
                    <div class="bank-number" contenteditable="true">ุดูุงุฑู ุญุณุงุจ ุง ฺฉุงุฑุช</div>
                </div>
                <div class="bank-delete">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            bankingGrid.insertBefore(bankingCard, addButton);
            
            // Add event listeners to the new bank card
            const bankDeleteBtn = bankingCard.querySelector('.bank-delete');
            bankDeleteBtn.addEventListener('click', function() {
                deleteBankCard(this);
            });
            
            const bankNumber = bankingCard.querySelector('.bank-number');
            bankNumber.addEventListener('click', function() {
                copyToClipboard(this);
            });
            
            showToast('ุญุณุงุจ ุจุงูฺฉ ุจุง ููููุช ุงุถุงูู ุดุฏ');
        }
        
        // Delete bank card
        function deleteBankCard(element) {
            element.parentElement.remove();
            showToast('ุญุณุงุจ ุจุงูฺฉ ุจุง ููููุช ุญุฐู ุดุฏ');
        }
        
        // Copy to clipboard
        function copyToClipboard(element) {
            const text = element.innerText;
            navigator.clipboard.writeText(text).then(function() {
                // Show temporary feedback
                const originalText = element.innerText;
                element.innerText = 'ฺฉูพ ุดุฏ!';
                setTimeout(() => {
                    element.innerText = originalText;
                }, 2000);
                showToast('ูุชู ุจุง ููููุช ฺฉูพ ุดุฏ');
            }).catch(function() {
                showToast('ุฎุทุง ุฏุฑ ฺฉูพ ฺฉุฑุฏู ูุชู');
            });
        }

        // Add contact item (phone or email)
        function addContactItem(sectionId, type) {
            const contactList = document.querySelector(`#${sectionId} .contact-items-list[data-type="${type}"]`);
            if (!contactList) return;
            
            const iconClass = type === 'phone' ? 'fa-phone' : 'fa-envelope';
            const label = type === 'phone' ? 'ุชููู ุฌุฏุฏ' : 'ุงูู ุฌุฏุฏ';
            const placeholder = type === 'phone' ? 'ุดูุงุฑู ุชููู' : 'ุขุฏุฑุณ ุงูู';
            
            const contactItem = document.createElement('div');
            contactItem.className = 'contact-item';
            contactItem.innerHTML = `
                <div class="contact-icon">
                    <i class="fas ${iconClass}"></i>
                </div>
                <div class="contact-info">
                    <div contenteditable="true" class="contact-label">${label}</div>
                    <p contenteditable="true">${placeholder}</p>
                </div>
                <div class="contact-item-delete">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            contactList.appendChild(contactItem);
            
            // Add event listener to delete button
            const deleteBtn = contactItem.querySelector('.contact-item-delete');
            deleteBtn.addEventListener('click', function() {
                deleteContactItem(this);
            });
            
            showToast(`${type === 'phone' ? 'ุชููู' : 'ุงูู'} ุฌุฏุฏ ุงุถุงูู ุดุฏ`);
        }

        // Delete contact item
        function deleteContactItem(element) {
            element.parentElement.remove();
            showToast('ุขุชู ุชูุงุณ ุญุฐู ุดุฏ');
        }

        // Initialize map
        function initMap(sectionId) {
            const mapElement = document.getElementById(`map-${sectionId}`);
            if (!mapElement) return;
            
            // ูููุนุช ูพุดโูุฑุถ (ุชูุฑุงู)
            const defaultPosition = [35.6892, 51.3890];
            
            // ุงุฌุงุฏ ููุดู
            const map = L.map(`map-${sectionId}`).setView(defaultPosition, 13);
            
            // ุงุถุงูู ฺฉุฑุฏู ูุงู ููุดู
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18
            }).addTo(map);
            
            // ุงุฌุงุฏ ูุงุฑฺฉุฑ
            const marker = L.marker(defaultPosition, {
                draggable: true
            }).addTo(map);
            
            marker.bindPopup('ูููุนุช ฺฉุณุจโูฺฉุงุฑ ุดูุง<br>ุจุฑุง ุฌุงุจุฌุงุ ูุงุฑฺฉุฑ ุฑุง ุจฺฉุดุฏ').openPopup();
            
            // ุฐุฎุฑู ููุดู ู ูุงุฑฺฉุฑ
            maps.set(sectionId, {
                map: map,
                marker: marker,
                defaultPosition: defaultPosition
            });
            
            // event ุจุฑุง ุชุบุฑ ูููุนุช ุจุง ฺฉูฺฉ ุฑู ููุดู
            map.on('click', function(e) {
                marker.setLatLng(e.latlng);
                marker.bindPopup('ูููุนุช ุฌุฏุฏ: ' + e.latlng.lat.toFixed(4) + ', ' + e.latlng.lng.toFixed(4)).openPopup();
                showToast('ูููุนุช ููุดู ุจูโุฑูุฒ ุดุฏ');
            });
            
            // event ุจุฑุง ููุช ูุงุฑฺฉุฑ ฺฉุดุฏู ูโุดู
            marker.on('dragend', function(e) {
                const position = marker.getLatLng();
                marker.bindPopup('ูููุนุช ุฌุฏุฏ: ' + position.lat.toFixed(4) + ', ' + position.lng.toFixed(4)).openPopup();
                showToast('ูููุนุช ููุดู ุจูโุฑูุฒ ุดุฏ');
            });
            
            return map;
        }

        // Search address on map
        function searchAddress(sectionId) {
            const searchInput = document.getElementById(`mapSearch-${sectionId}`);
            const query = searchInput.value.trim();
            
            if (!query) {
                showToast('ูุทูุงู ุขุฏุฑุณ ุจุฑุง ุฌุณุชุฌู ูุงุฑุฏ ฺฉูุฏ');
                return;
            }
            
            showToast('ุฏุฑ ุญุงู ุฌุณุชุฌู ุขุฏุฑุณ...');
            
            // ุงุณุชูุงุฏู ุงุฒ Nominatim API ุจุฑุง ุฌุณุชุฌู ุขุฏุฑุณ
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1&accept-language=fa`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        const result = data[0];
                        const lat = parseFloat(result.lat);
                        const lon = parseFloat(result.lon);
                        
                        const mapData = maps.get(sectionId);
                        if (mapData) {
                            mapData.map.setView([lat, lon], 16);
                            mapData.marker.setLatLng([lat, lon]);
                            mapData.marker.bindPopup(result.display_name).openPopup();
                            showToast('ุขุฏุฑุณ ูพุฏุง ุดุฏ ู ููุดู ุจูโุฑูุฒ ุดุฏ');
                        }
                    } else {
                        showToast('ุขุฏุฑุณ ุงูุช ูุดุฏ');
                    }
                })
                .catch(error => {
                    console.error('Error searching address:', error);
                    showToast('ุฎุทุง ุฏุฑ ุฌุณุชุฌู ุขุฏุฑุณ');
                });
        }

        // Reset map to default position
        function resetMap(sectionId) {
            const mapData = maps.get(sectionId);
            if (mapData) {
                mapData.map.setView(mapData.defaultPosition, 13);
                mapData.marker.setLatLng(mapData.defaultPosition);
                mapData.marker.bindPopup('ูููุนุช ูพุดโูุฑุถ').openPopup();
                showToast('ููุดู ุจู ูููุนุช ูพุดโูุฑุถ ุจุงุฒฺฏุดุช');
            }
        }
        
        // Update navigation menu
        function updateNavigation() {
            // Clear existing navigation items
            navContainer.innerHTML = '';
            
            // Add hero section to navigation
            const heroNavItem = document.createElement('div');
            heroNavItem.className = 'nav-item active';
            heroNavItem.textContent = 'ุตูุญู ุงุตู';
            heroNavItem.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                this.classList.add('active');
                
                // Highlight the section
                highlightSection('section-hero');
                
                document.getElementById('section-hero').scrollIntoView({ behavior: 'smooth' });
            });
            navContainer.appendChild(heroNavItem);
            
            // Add other sections to navigation
            document.querySelectorAll('.section').forEach(section => {
                const sectionId = section.id;
                const sectionTitle = section.querySelector('.section-title-text').textContent || 'ุจุฎุด ุฌุฏุฏ';
                
                const navItem = document.createElement('div');
                navItem.className = 'nav-item';
                navItem.textContent = sectionTitle;
                navItem.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Highlight the section
                    highlightSection(sectionId);
                    
                    section.scrollIntoView({ behavior: 'smooth' });
                });
                
                navContainer.appendChild(navItem);
            });
        }
        
        // Highlight a section for 3 seconds
        function highlightSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('highlighted');
                
                setTimeout(() => {
                    section.classList.remove('highlighted');
                }, 3000);
            }
        }
        
        // Initialize drag and drop with Sortable
        function initSortable() {
            // This is a simplified version - in a real implementation, you would use a library like SortableJS
            // For this example, we'll just add a basic drag and drop indicator
            const sections = document.querySelectorAll('.section, .hero-section');
            
            sections.forEach(section => {
                section.setAttribute('draggable', 'true');
                
                section.addEventListener('dragstart', function(e) {
                    this.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', this.id);
                });
                
                section.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
            });
            
            mainContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(mainContainer, e.clientY);
                const draggable = document.querySelector('.dragging');
                
                if (afterElement == null) {
                    mainContainer.appendChild(draggable);
                } else {
                    mainContainer.insertBefore(draggable, afterElement);
                }
                
                // Update navigation after reordering
                updateNavigation();
            });
        }
        
        // Helper function for drag and drop
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.section, .hero-section:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // Apply theme changes
        function applyTheme() {
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const buttonColor = document.getElementById('buttonColor').value;
            
            document.documentElement.style.setProperty('--primary-color', primaryColor);
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
            document.documentElement.style.setProperty('--button-color', buttonColor);
            
            // Save to localStorage
            localStorage.setItem('primaryColor', primaryColor);
            localStorage.setItem('secondaryColor', secondaryColor);
            localStorage.setItem('buttonColor', buttonColor);
            
            showToast('ุชูุธูุงุช ุธุงูุฑ ุจุง ููููุช ุงุนูุงู ุดุฏ');
        }
        
        // Apply background image
        function applyBackgroundImage() {
            const fileInput = document.getElementById('bgImageUpload');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('heroBg').src = e.target.result;
                    
                    // Save to localStorage
                    localStorage.setItem('backgroundImage', e.target.result);
                    
                    showToast('ุชุตูุฑ ูพุณโุฒููู ุจุง ููููุช ุงุนูุงู ุดุฏ');
                };
                reader.readAsDataURL(file);
            } else {
                showToast('ูุทูุงู ฺฉ ุชุตูุฑ ุงูุชุฎุงุจ ฺฉูุฏ');
            }
        }
        
        // Save data to localStorage
        function saveData() {
            const data = {
                businessName: document.getElementById('businessName').textContent,
                businessTagline: document.getElementById('businessTagline').textContent,
                businessLogo: businessLogo.src,
                primaryColor: document.getElementById('primaryColor').value,
                secondaryColor: document.getElementById('secondaryColor').value,
                buttonColor: document.getElementById('buttonColor').value,
                backgroundImage: document.getElementById('heroBg').src,
                textAlign: getComputedStyle(document.documentElement).getPropertyValue('--text-align').trim(),
                sections: []
            };
            
            // Save section data
            document.querySelectorAll('.section').forEach(section => {
                const sectionData = {
                    id: section.id,
                    type: section.getAttribute('data-section'),
                    title: section.querySelector('.section-title-text').textContent,
                    content: section.innerHTML
                };
                
                data.sections.push(sectionData);
            });
            
            // Create a download link
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
            const downloadAnchor = document.createElement('a');
            downloadAnchor.setAttribute("href", dataStr);
            downloadAnchor.setAttribute("download", "landing-page-data.json");
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            document.body.removeChild(downloadAnchor);
            
            // Also save to localStorage
            localStorage.setItem('landingPageData', JSON.stringify(data));
            
            showToast('ุชูุธูุงุช ุจุง ููููุช ุฐุฎุฑู ุดุฏ');
        }
        
        // Save page as HTML
        function saveHTML() {
            // Create a clone of the document
            const htmlContent = document.documentElement.outerHTML;
            
            // Create a temporary DOM parser to remove CMS elements
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            
            // Remove CMS controls and related elements
            const elementsToRemove = [
                '.cms-toggle',
                '.cms-controls',
                '.add-section-main',
                '.section-modal',
                '.social-modal',
                '.toast'
            ];
            
            elementsToRemove.forEach(selector => {
                const elements = doc.querySelectorAll(selector);
                elements.forEach(el => el.remove());
            });
            
            // Remove contenteditable attributes
            const editableElements = doc.querySelectorAll('[contenteditable="true"]');
            editableElements.forEach(el => {
                el.removeAttribute('contenteditable');
            });
            
            // Remove delete buttons
            const deleteButtons = doc.querySelectorAll('.delete-section, .social-delete, .gallery-delete, .bank-delete, .contact-item-delete');
            deleteButtons.forEach(btn => btn.remove());
            
            // Remove add buttons
            const addButtons = doc.querySelectorAll('.add-service-btn, .add-testimonial-btn, .add-social-btn, .add-gallery-item, .add-banking-btn, .add-contact-item-btn');
            addButtons.forEach(btn => btn.remove());
            
            // Remove upload text
            const uploadTexts = doc.querySelectorAll('.logo-upload-text, .image-upload-text');
            uploadTexts.forEach(text => text.remove());
            
            // Remove map controls
            const mapControls = doc.querySelectorAll('.map-controls');
            mapControls.forEach(control => control.remove());
            
            // Remove map instructions
            const mapInstructions = doc.querySelectorAll('.map-instructions');
            mapInstructions.forEach(instruction => instruction.remove());
            
            // Fix CSS to remove right margin when CMS panel is removed
            const mainContainer = doc.querySelector('.main-container');
            if (mainContainer) {
                mainContainer.style.marginRight = '0';
                mainContainer.classList.remove('cms-open');
            }
            
            // Serialize the modified document back to a string
            const cleanHTML = '<!DOCTYPE html>\n' + doc.documentElement.outerHTML;
            
            // Create a Blob and download the file
            const blob = new Blob([cleanHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'landing-page.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('ุตูุญู ุจุง ููููุช ุจู ุตูุฑุช HTML ุฐุฎุฑู ุดุฏ');
        }
        
        // Import data from file
        function importData() {
            const fileInput = document.getElementById('loadData');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        loadData(data);
                        showToast('ุชูุธูุงุช ุจุง ููููุช ุจุงุฑฺฏุฐุงุฑ ุดุฏ');
                    } catch (error) {
                        showToast('ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ูุงู');
                    }
                };
                reader.readAsText(file);
            } else {
                showToast('ูุทูุงู ฺฉ ูุงู ุงูุชุฎุงุจ ฺฉูุฏ');
            }
        }
        
        // Load saved data
        function loadSavedData() {
            const savedData = localStorage.getItem('landingPageData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                loadData(data);
            }
        }
        
        // Load data into the page
        function loadData(data) {
            // Load basic info
            if (data.businessName) {
                document.getElementById('businessName').textContent = data.businessName;
            }
            
            if (data.businessTagline) {
                document.getElementById('businessTagline').textContent = data.businessTagline;
            }
            
            if (data.businessLogo) {
                businessLogo.src = data.businessLogo;
                navLogo.src = data.businessLogo;
                dynamicFavicon.href = data.businessLogo;
            }
            
            if (data.primaryColor) {
                document.getElementById('primaryColor').value = data.primaryColor;
                document.getElementById('primaryColorText').value = data.primaryColor;
                document.documentElement.style.setProperty('--primary-color', data.primaryColor);
            }
            
            if (data.secondaryColor) {
                document.getElementById('secondaryColor').value = data.secondaryColor;
                document.getElementById('secondaryColorText').value = data.secondaryColor;
                document.documentElement.style.setProperty('--secondary-color', data.secondaryColor);
            }
            
            if (data.buttonColor) {
                document.getElementById('buttonColor').value = data.buttonColor;
                document.getElementById('buttonColorText').value = data.buttonColor;
                document.documentElement.style.setProperty('--button-color', data.buttonColor);
            }
            
            if (data.backgroundImage) {
                document.getElementById('heroBg').src = data.backgroundImage;
            }
            
            if (data.textAlign) {
                document.documentElement.style.setProperty('--text-align', data.textAlign);
                document.querySelectorAll('.alignment-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('data-align') === data.textAlign) {
                        btn.classList.add('active');
                    }
                });
                
                // Update navigation layout
                updateNavLayout(data.textAlign);
            }
            
            // Load sections
            if (data.sections && data.sections.length > 0) {
                // Remove existing sections (except hero)
                document.querySelectorAll('.section').forEach(section => section.remove());
                
                // Add saved sections
                data.sections.forEach(sectionData => {
                    const sectionHTML = `
                        <section class="section" id="${sectionData.id}" data-section="${sectionData.type}">
                            ${sectionData.content}
                        </section>
                    `;
                    
                    mainContainer.insertAdjacentHTML('beforeend', sectionHTML);
                    
                    // Initialize map for contact sections
                    if (sectionData.type === 'contact') {
                        setTimeout(() => {
                            initMap(sectionData.id);
                        }, 500);
                    }
                });
                
                // Update sections array
                sections = data.sections;
            }
            
            // Update navigation
            updateNavigation();
        }
        
        // Image compression function
        function compressImage(file, maxSizeKB, callback) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            
            reader.onload = function(event) {
                const img = new Image();
                img.src = event.target.result;
                
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Calculate new dimensions while maintaining aspect ratio
                    let width = img.width;
                    let height = img.height;
                    const maxDimension = 1200; // Maximum dimension for compression
                    
                    if (width > height && width > maxDimension) {
                        height = Math.round((height * maxDimension) / width);
                        width = maxDimension;
                    } else if (height > maxDimension) {
                        width = Math.round((width * maxDimension) / height);
                        height = maxDimension;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw image on canvas
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Get compressed data URL
                    let quality = 0.9;
                    let compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    
                    // Check if the compressed image is under the size limit
                    const sizeKB = Math.round((compressedDataUrl.length * 3) / 4 / 1024);
                    
                    // If still too large, reduce quality further
                    if (sizeKB > maxSizeKB) {
                        quality = maxSizeKB / sizeKB * 0.9;
                        compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    }
                    
                    callback(compressedDataUrl);
                };
            };
        }
        
        // Add image to gallery
        function addGalleryImage(imageSrc) {
            const gallerySections = document.querySelectorAll('[data-section="gallery"]');
            if (gallerySections.length === 0) return;
            
            const galleryGrid = gallerySections[0].querySelector('.gallery-grid');
            const addButton = galleryGrid.querySelector('.add-gallery-item');
            
            const galleryItem = document.createElement('div');
            galleryItem.className = 'gallery-item';
            galleryItem.innerHTML = `
                <img src="${imageSrc}" alt="ุชุตูุฑ ฺฏุงูุฑ">
                <div class="gallery-delete">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            // Add event listeners to the new gallery item
            const galleryDeleteBtn = galleryItem.querySelector('.gallery-delete');
            galleryDeleteBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                deleteGalleryImage(this);
            });
            
            // Add click event to open lightbox
            galleryItem.addEventListener('click', function(e) {
                if (!e.target.classList.contains('gallery-delete') && !e.target.closest('.gallery-delete')) {
                    const index = galleryImages.findIndex(img => img.src === imageSrc);
                    if (index !== -1) {
                        openLightbox(index);
                    }
                }
            });
            
            galleryGrid.insertBefore(galleryItem, addButton);
            
            // Add to gallery images array
            galleryImages.push({ src: imageSrc, element: galleryItem });
        }
        
        // Delete gallery image
        function deleteGalleryImage(element) {
            const galleryItem = element.closest('.gallery-item');
            const imgSrc = galleryItem.querySelector('img').src;
            
            // Remove from array
            galleryImages = galleryImages.filter(img => img.src !== imgSrc);
            
            // Remove from DOM
            galleryItem.remove();
            
            showToast('ุชุตูุฑ ุงุฒ ฺฏุงูุฑ ุญุฐู ุดุฏ');
        }
        
        // Show toast notification
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
