<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ù†Ø¯ÛŒÚ¯ Ù¾ÛŒØ¬ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø§ CMS</title>
    <link rel="icon" type="image/x-icon" id="dynamicFavicon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¢</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/components/navigation.css">
    <link rel="stylesheet" href="./css/components/cms-panel.css">
    <link rel="stylesheet" href="./css/components/sections.css">
    <link rel="stylesheet" href="./css/components/modals.css">
    <link rel="stylesheet" href="./css/components/responsive.css">
</head>
<body>
    <!-- Navigation -->
    <div class="fixed-nav">
        <div class="nav-logo">
            <img id="navLogo" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¢</text></svg>" alt="Ù„ÙˆÚ¯Ùˆ">
        </div>
        <div class="nav-container" id="navContainer"></div>
    </div>
    
    <!-- CMS Controls -->
    <div class="cms-toggle" id="cmsToggle">
        <i class="fas fa-cog"></i>
    </div>
    
    <div class="cms-controls" id="cmsControls">
        <div class="cms-section">
            <h3><i class="fas fa-palette"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¸Ø§Ù‡Ø±ÛŒ</h3>
            <div class="cms-control">
                <label>Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ</label>
                <div class="color-picker">
                    <input type="color" id="primaryColor" value="#3498db">
                    <input type="text" id="primaryColorText" value="#3498db">
                </div>
            </div>
            <div class="cms-control">
                <label>Ø±Ù†Ú¯ Ø«Ø§Ù†ÙˆÛŒÙ‡</label>
                <div class="color-picker">
                    <input type="color" id="secondaryColor" value="#2c3e50">
                    <input type="text" id="secondaryColorText" value="#2c3e50">
                </div>
            </div>
            <div class="cms-control">
                <label>Ø±Ù†Ú¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§</label>
                <div class="color-picker">
                    <input type="color" id="buttonColor" value="#e74c3c">
                    <input type="text" id="buttonColorText" value="#e74c3c">
                </div>
            </div>
            <div class="cms-control">
                <label>ØªØ±Ø§Ø² Ù…ØªÙ†</label>
                <div class="alignment-controls">
                    <div class="alignment-btn active" data-align="right">Ø±Ø§Ø³Øª</div>
                    <div class="alignment-btn" data-align="center">ÙˆØ³Ø·</div>
                    <div class="alignment-btn" data-align="left">Ú†Ù¾</div>
                </div>
            </div>
            <div class="cms-control">
                <button id="applyTheme">Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª</button>
            </div>
        </div>
        
        <div class="cms-section">
            <h3><i class="fas fa-image"></i> ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</h3>
            <div class="cms-control">
                <input type="file" id="bgImageUpload" accept="image/*">
                <button id="applyBgImage">Ø§Ø¹Ù…Ø§Ù„ ØªØµÙˆÛŒØ±</button>
            </div>
        </div>
        
        <div class="cms-section">
            <h3><i class="fas fa-download"></i> Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</h3>
            <div class="cms-control">
                <button id="saveData">Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
            </div>
            <div class="cms-control">
                <button id="saveHTML">Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª HTML</button>
            </div>
            <div class="cms-control">
                <input type="file" id="loadData" accept=".json">
                <button id="importData">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
            </div>
        </div>
    </div>
    
    <!-- Main Content Container -->
    <div class="main-container" id="mainContainer">
        <!-- Hero Section -->
        <section class="hero-section" id="section-hero" data-section="hero">
            <img class="hero-bg" id="heroBg" src="" alt="Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡">
            <div class="hero-content">
                <div class="business-info">
                    <div class="logo-container" id="logoContainer">
                        <img id="businessLogo" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¢</text></svg>" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±">
                        <div class="logo-upload-text">Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ù„ÙˆÚ¯Ùˆ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
                    </div>
                    <div class="business-text">
                        <h1 contenteditable="true" class="editable" id="businessName">Ù†Ø§Ù… Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ø´Ù…Ø§</h1>
                        <p contenteditable="true" class="editable" id="businessTagline">ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ø´Ù…Ø§</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Add Section Button -->
    <div class="add-section-main" id="addSectionMain">
        <i class="fas fa-plus"></i>
    </div>
    
    <!-- Section Selection Modal -->
    <div class="section-modal" id="sectionModal">
        <div class="section-modal-content">
            <div class="section-modal-header">
                <h2>Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯</h2>
                <div class="section-modal-close" id="sectionModalClose">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="section-options">
                <div class="section-option" data-type="about">
                    <i class="fas fa-info-circle"></i>
                    <span>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</span>
                </div>
                <div class="section-option" data-type="services">
                    <i class="fas fa-concierge-bell"></i>
                    <span>Ø®Ø¯Ù…Ø§Øª</span>
                </div>
                <div class="section-option" data-type="testimonials">
                    <i class="fas fa-comment-alt"></i>
                    <span>Ù†Ø¸Ø±Ø§Øª Ù…Ø´ØªØ±ÛŒØ§Ù†</span>
                </div>
                <div class="section-option" data-type="gallery">
                    <i class="fas fa-images"></i>
                    <span>Ú¯Ø§Ù„Ø±ÛŒ ØªØµØ§ÙˆÛŒØ±</span>
                </div>
                <div class="section-option" data-type="social">
                    <i class="fas fa-share-alt"></i>
                    <span>Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</span>
                </div>
                <div class="section-option" data-type="banking">
                    <i class="fas fa-credit-card"></i>
                    <span>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ù†Ú©ÛŒ</span>
                </div>
                <div class="section-option" data-type="contact">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>ØªÙ…Ø§Ø³ Ùˆ Ù†Ù‚Ø´Ù‡</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Social Media Selection Modal -->
    <div class="social-modal" id="socialModal">
        <div class="social-modal-content">
            <div class="social-modal-header">
                <h2>Ø§ÙØ²ÙˆØ¯Ù† Ø´Ø¨Ú©Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</h2>
                <div class="social-modal-close" id="socialModalClose">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="social-options">
                <div class="social-option" data-platform="instagram">
                    <i class="fab fa-instagram"></i>
                    <span>Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</span>
                </div>
                <div class="social-option" data-platform="telegram">
                    <i class="fab fa-telegram"></i>
                    <span>ØªÙ„Ú¯Ø±Ø§Ù…</span>
                </div>
                <div class="social-option" data-platform="whatsapp">
                    <i class="fab fa-whatsapp"></i>
                    <span>ÙˆØ§ØªØ³Ø§Ù¾</span>
                </div>
                <div class="social-option" data-platform="twitter">
                    <i class="fab fa-twitter"></i>
                    <span>ØªÙˆÛŒÛŒØªØ±</span>
                </div>
                <div class="social-option" data-platform="linkedin">
                    <i class="fab fa-linkedin"></i>
                    <span>Ù„ÛŒÙ†Ú©Ø¯ÛŒÙ†</span>
                </div>
                <div class="social-option" data-platform="youtube">
                    <i class="fab fa-youtube"></i>
                    <span>ÛŒÙˆØªÛŒÙˆØ¨</span>
                </div>
            </div>
            <div class="social-input">
                <input type="text" id="socialUsername" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø¢Ø¯Ø±Ø³">
                <button id="addSocialConfirm">Ø§ÙØ²ÙˆØ¯Ù†</button>
            </div>
        </div>
    </div>
    
    <!-- Lightbox for Gallery -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-close" id="lightboxClose">
            <i class="fas fa-times"></i>
        </div>
        <div class="lightbox-nav">
            <button id="lightboxPrev"><i class="fas fa-chevron-right"></i></button>
            <button id="lightboxNext"><i class="fas fa-chevron-left"></i></button>
        </div>
        <div class="lightbox-content">
            <img id="lightboxImage" src="" alt="ØªØµÙˆÛŒØ± Ø¨Ø²Ø±Ú¯â€ŒØ´Ø¯Ù‡">
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <!-- Hidden file input for logo upload -->
    <input type="file" id="logoUpload" accept="image/*" style="display: none;">
    
    <!-- Hidden file input for gallery upload -->
    <input type="file" id="galleryUpload" accept="image/*" multiple style="display: none;">
    
    <!-- Hidden file input for about image upload -->
    <input type="file" id="aboutImageUpload" accept="image/*" style="display: none;">

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- All JavaScript in one file -->
    <script>
        // Global variables
        let sections = [];
        let currentSectionType = '';
        let currentSocialPlatform = '';
        let galleryImages = [];
        let currentGalleryIndex = 0;
        let map = null;
        let mapMarker = null;
        
        // DOM elements
        const cmsToggle = document.getElementById('cmsToggle');
        const cmsControls = document.getElementById('cmsControls');
        const mainContainer = document.getElementById('mainContainer');
        const addSectionMain = document.getElementById('addSectionMain');
        const sectionModal = document.getElementById('sectionModal');
        const sectionModalClose = document.getElementById('sectionModalClose');
        const sectionOptions = document.querySelectorAll('.section-option');
        const socialModal = document.getElementById('socialModal');
        const socialModalClose = document.getElementById('socialModalClose');
        const socialOptions = document.querySelectorAll('.social-option');
        const addSocialConfirm = document.getElementById('addSocialConfirm');
        const socialUsername = document.getElementById('socialUsername');
        const lightbox = document.getElementById('lightbox');
        const lightboxClose = document.getElementById('lightboxClose');
        const lightboxImage = document.getElementById('lightboxImage');
        const lightboxPrev = document.getElementById('lightboxPrev');
        const lightboxNext = document.getElementById('lightboxNext');
        const logoUpload = document.getElementById('logoUpload');
        const logoContainer = document.getElementById('logoContainer');
        const businessLogo = document.getElementById('businessLogo');
        const navLogo = document.getElementById('navLogo');
        const galleryUpload = document.getElementById('galleryUpload');
        const aboutImageUpload = document.getElementById('aboutImageUpload');
        const navContainer = document.getElementById('navContainer');
        const dynamicFavicon = document.getElementById('dynamicFavicon');
        const toast = document.getElementById('toast');
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded successfully!');
            
            // Load saved data if available
            loadSavedData();
            
            // Initialize navigation
            updateNavigation();
            
            // Event listeners
            cmsToggle.addEventListener('click', toggleCMS);
            addSectionMain.addEventListener('click', openSectionModal);
            sectionModalClose.addEventListener('click', closeSectionModal);
            socialModalClose.addEventListener('click', closeSocialModal);
            lightboxClose.addEventListener('click', closeLightbox);
            lightboxPrev.addEventListener('click', showPrevImage);
            lightboxNext.addEventListener('click', showNextImage);
            logoContainer.addEventListener('click', () => logoUpload.click());
            logoUpload.addEventListener('change', handleLogoUpload);
            
            // Section selection
            sectionOptions.forEach(option => {
                option.addEventListener('click', function() {
                    currentSectionType = this.getAttribute('data-type');
                    addSection(currentSectionType);
                    closeSectionModal();
                });
            });
            
            // Social platform selection
            socialOptions.forEach(option => {
                option.addEventListener('click', function() {
                    socialOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    currentSocialPlatform = this.getAttribute('data-platform');
                });
            });
            
            // Add social media
            addSocialConfirm.addEventListener('click', addSocialMedia);
            
            // Theme controls
            document.getElementById('applyTheme').addEventListener('click', applyTheme);
            document.getElementById('applyBgImage').addEventListener('click', applyBackgroundImage);
            document.getElementById('saveData').addEventListener('click', saveData);
            document.getElementById('saveHTML').addEventListener('click', saveHTML);
            document.getElementById('importData').addEventListener('click', importData);
            
            // Color picker synchronization
            document.getElementById('primaryColor').addEventListener('input', function() {
                document.getElementById('primaryColorText').value = this.value;
            });
            document.getElementById('primaryColorText').addEventListener('input', function() {
                document.getElementById('primaryColor').value = this.value;
            });
            
            document.getElementById('secondaryColor').addEventListener('input', function() {
                document.getElementById('secondaryColorText').value = this.value;
            });
            document.getElementById('secondaryColorText').addEventListener('input', function() {
                document.getElementById('secondaryColor').value = this.value;
            });
            
            document.getElementById('buttonColor').addEventListener('input', function() {
                document.getElementById('buttonColorText').value = this.value;
            });
            document.getElementById('buttonColorText').addEventListener('input', function() {
                document.getElementById('buttonColor').value = this.value;
            });
            
            // Text alignment controls
            document.querySelectorAll('.alignment-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.alignment-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const alignment = this.getAttribute('data-align');
                    document.documentElement.style.setProperty('--text-align', alignment);
                    
                    // Update navigation layout based on alignment
                    updateNavLayout(alignment);
                });
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === sectionModal) {
                    closeSectionModal();
                }
                if (event.target === socialModal) {
                    closeSocialModal();
                }
                if (event.target === lightbox) {
                    closeLightbox();
                }
            });
            
            // Initialize Sortable for drag and drop
            initSortable();

            // Handle gallery upload
            galleryUpload.addEventListener('change', handleGalleryUpload);

            console.log('All event listeners initialized!');
        });
        
        // Update navigation layout based on text alignment
        function updateNavLayout(alignment) {
            const fixedNav = document.querySelector('.fixed-nav');
            
            if (alignment === 'right') {
                // RTL layout - logo on the right
                document.documentElement.style.setProperty('--nav-direction', 'row');
                document.documentElement.style.setProperty('--logo-order', '1');
                document.documentElement.style.setProperty('--nav-items-order', '0');
                fixedNav.style.flexDirection = 'row';
            } else if (alignment === 'left') {
                // LTR layout - logo on the left
                document.documentElement.style.setProperty('--nav-direction', 'row');
                document.documentElement.style.setProperty('--logo-order', '0');
                document.documentElement.style.setProperty('--nav-items-order', '1');
                fixedNav.style.flexDirection = 'row';
            } else {
                // Center alignment - logo above nav items
                document.documentElement.style.setProperty('--nav-direction', 'column');
                document.documentElement.style.setProperty('--logo-order', '0');
                document.documentElement.style.setProperty('--nav-items-order', '1');
                fixedNav.style.flexDirection = 'column';
            }
        }
        
        // Toggle CMS controls panel
        function toggleCMS() {
            cmsControls.classList.toggle('active');
            mainContainer.classList.toggle('cms-open');
            showToast('Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ' + (cmsControls.classList.contains('active') ? 'Ø¨Ø§Ø²' : 'Ø¨Ø³ØªÙ‡') + ' Ø´Ø¯');
        }
        
        // Open section selection modal
        function openSectionModal() {
            sectionModal.classList.add('active');
            showToast('Ù…Ù†ÙˆÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø®Ø´ Ø¨Ø§Ø² Ø´Ø¯');
        }
        
        // Close section selection modal
        function closeSectionModal() {
            sectionModal.classList.remove('active');
        }
        
        // Open social media selection modal
        function openSocialModal() {
            socialModal.classList.add('active');
        }
        
        // Close social media selection modal
        function closeSocialModal() {
            socialModal.classList.remove('active');
            socialOptions.forEach(opt => opt.classList.remove('active'));
            socialUsername.value = '';
            currentSocialPlatform = '';
        }
        
        // Open lightbox
        function openLightbox(index) {
            currentGalleryIndex = index;
            lightboxImage.src = galleryImages[index].src;
            lightbox.classList.add('show');
        }
        
        // Close lightbox
        function closeLightbox() {
            lightbox.classList.remove('show');
        }
        
        // Show previous image in lightbox
        function showPrevImage() {
            currentGalleryIndex = (currentGalleryIndex - 1 + galleryImages.length) % galleryImages.length;
            lightboxImage.src = galleryImages[currentGalleryIndex].src;
        }
        
        // Show next image in lightbox
        function showNextImage() {
            currentGalleryIndex = (currentGalleryIndex + 1) % galleryImages.length;
            lightboxImage.src = galleryImages[currentGalleryIndex].src;
        }
        
        // Handle logo upload
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                compressImage(file, 300, function(compressedDataUrl) {
                    businessLogo.src = compressedDataUrl;
                    navLogo.src = compressedDataUrl;
                    dynamicFavicon.href = compressedDataUrl;
                    
                    // Save to localStorage
                    localStorage.setItem('businessLogo', compressedDataUrl);
                    
                    showToast('Ù„ÙˆÚ¯Ùˆ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯');
                });
            }
            event.target.value = '';
        }

        // Handle gallery upload
        function handleGalleryUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                let processedCount = 0;
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    compressImage(file, 300, function(compressedDataUrl) {
                        addGalleryImage(compressedDataUrl);
                        processedCount++;
                        
                        if (processedCount === files.length) {
                            showToast(`${files.length} ØªØµÙˆÛŒØ± Ø¨Ù‡ Ú¯Ø§Ù„Ø±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`);
                        }
                    });
                }
            }
            event.target.value = '';
        }
        
        // Add a new section
        function addSection(type) {
            const sectionId = 'section-' + Date.now();
            let sectionHTML = '';
            
            switch(type) {
                case 'about':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="about">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</div>
                                <div class="delete-section" data-section-id="${sectionId}">Ø­Ø°Ù</div>
                            </div>
                            <div class="about-content">
                                <div class="about-image" id="aboutImage-${sectionId}">
                                    <i class="fas fa-image" style="font-size: 48px; opacity: 0.5;"></i>
                                    <div class="image-upload-text">Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± ØªØµÙˆÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
                                </div>
                                <div class="about-text">
                                    <p contenteditable="true">Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ø®ÙˆØ¯ Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡ÛŒØ¯. ØªØ§Ø±ÛŒØ®Ú†Ù‡ØŒ Ù…Ø§Ù…ÙˆØ±ÛŒØªØŒ Ú†Ø´Ù…â€ŒØ§Ù†Ø¯Ø§Ø² Ùˆ Ø§Ø±Ø²Ø´â€ŒÙ‡Ø§ÛŒ Ø´Ø±Ú©Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø´Ø±Ø­ Ø¯Ù‡ÛŒØ¯.</p>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'services':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="services">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">Ø®Ø¯Ù…Ø§Øª Ù…Ø§</div>
                                <div class="delete-section" data-section-id="${sectionId}">Ø­Ø°Ù</div>
                            </div>
                            <div class="services-grid">
                                <div class="service-card">
                                    <h3 contenteditable="true">Ø®Ø¯Ù…Ø§Øª Ù…Ø´Ø§ÙˆØ±Ù‡</h3>
                                    <p contenteditable="true">ØªÙˆØ¶ÛŒØ­ Ù…Ø®ØªØµØ±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§ÛŒÙ† Ø®Ø¯Ù…Øª Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡ÛŒØ¯.</p>
                                </div>
                                <div class="service-card">
                                    <h3 contenteditable="true">Ø·Ø±Ø§Ø­ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡</h3>
                                    <p contenteditable="true">ØªÙˆØ¶ÛŒØ­ Ù…Ø®ØªØµØ±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§ÛŒÙ† Ø®Ø¯Ù…Øª Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡ÛŒØ¯.</p>
                                </div>
                                <div class="service-card">
                                    <h3 contenteditable="true">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</h3>
                                    <p contenteditable="true">ØªÙˆØ¶ÛŒØ­ Ù…Ø®ØªØµØ±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§ÛŒÙ† Ø®Ø¯Ù…Øª Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡ÛŒØ¯.</p>
                                </div>
                                <div class="add-service-btn" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>Ø§ÙØ²ÙˆØ¯Ù† Ø®Ø¯Ù…Øª Ø¬Ø¯ÛŒØ¯</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'testimonials':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="testimonials">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">Ù†Ø¸Ø±Ø§Øª Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
                                <div class="delete-section" data-section-id="${sectionId}">Ø­Ø°Ù</div>
                            </div>
                            <div class="testimonials-grid">
                                <div class="testimonial-card">
                                    <p contenteditable="true">"Ø§ÛŒÙ† Ø´Ø±Ú©Øª Ø®Ø¯Ù…Ø§Øª ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. Ù…Ù† Ø¨Ø³ÛŒØ§Ø± Ø±Ø§Ø¶ÛŒ Ù‡Ø³ØªÙ… Ùˆ Ø¨Ù‡ Ø¯ÛŒÚ¯Ø±Ø§Ù† Ù†ÛŒØ² ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ù…."</p>
                                    <div class="client" contenteditable="true">- Ù…Ø­Ù…Ø¯ Ø±Ø¶Ø§ÛŒÛŒ</div>
                                </div>
                                <div class="testimonial-card">
                                    <p contenteditable="true">"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¹Ø§Ù„ÛŒ Ùˆ Ø®Ø¯Ù…Ø§Øª Ø¨Ø§ Ú©ÛŒÙÛŒØª. Ø­ØªÙ…Ø§Ù‹ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø®ÙˆØ§Ù‡ÛŒÙ… Ú©Ø±Ø¯."</p>
                                    <div class="client" contenteditable="true">- ÙØ§Ø·Ù…Ù‡ Ù…Ø­Ù…Ø¯ÛŒ</div>
                                </div>
                                <div class="add-testimonial-btn" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>Ø§ÙØ²ÙˆØ¯Ù† Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'gallery':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="gallery">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">Ú¯Ø§Ù„Ø±ÛŒ ØªØµØ§ÙˆÛŒØ±</div>
                                <div class="delete-section" data-section-id="${sectionId}">Ø­Ø°Ù</div>
                            </div>
                            <div class="gallery-grid">
                                <div class="add-gallery-item" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>Ø§ÙØ²ÙˆØ¯Ù† ØªØµÙˆÛŒØ±</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'social':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="social">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</div>
                                <div class="delete-section" data-section-id="${sectionId}">Ø­Ø°Ù</div>
                            </div>
                            <div class="social-grid">
                                <div class="add-social-btn" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>Ø§ÙØ²ÙˆØ¯Ù† Ø´Ø¨Ú©Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'banking':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="banking">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ù†Ú©ÛŒ</div>
                                <div class="delete-section" data-section-id="${sectionId}">Ø­Ø°Ù</div>
                            </div>
                            <div class="banking-grid">
                                <div class="banking-card">
                                    <div class="bank-icon">
                                        <i class="fas fa-university"></i>
                                    </div>
                                    <div class="bank-info">
                                        <div contenteditable="true">Ø¨Ø§Ù†Ú© Ù…Ù„ÛŒ</div>
                                        <div class="bank-number" contenteditable="true">6037-9910-1234-5678</div>
                                    </div>
                                    <div class="bank-delete">
                                        <i class="fas fa-times"></i>
                                    </div>
                                </div>
                                <div class="add-banking-btn" data-section-id="${sectionId}">
                                    <i class="fas fa-plus"></i>
                                    <span>Ø§ÙØ²ÙˆØ¯Ù† Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ</span>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
                    
                case 'contact':
                    sectionHTML = `
                        <section class="section" id="${sectionId}" data-section="contact">
                            <div class="section-title">
                                <div class="section-title-text" contenteditable="true">ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</div>
                                <div class="delete-section" data-section-id="${sectionId}">Ø­Ø°Ù</div>
                            </div>
                            <div class="contact-map-section">
                                <div class="contact-grid">
                                    <div class="contact-item">
                                        <div class="contact-icon">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </div>
                                        <div class="contact-info">
                                            <h3 contenteditable="true">Ø¢Ø¯Ø±Ø³</h3>
                                            <p contenteditable="true">ØªÙ‡Ø±Ø§Ù†ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ú©ÙˆÚ†Ù‡ ÙÙ„Ø§Ù†ØŒ Ù¾Ù„Ø§Ú© Û±Û²Û³</p>
                                        </div>
                                    </div>
                                    <div class="contact-item">
                                        <div class="contact-icon">
                                            <i class="fas fa-phone"></i>
                                        </div>
                                        <div class="contact-info">
                                            <h3 contenteditable="true">ØªÙ„ÙÙ†</h3>
                                            <p contenteditable="true">Û°Û²Û±-Û±Û²Û³Û´ÛµÛ¶Û·Û¸</p>
                                        </div>
                                    </div>
                                    <div class="contact-item">
                                        <div class="contact-icon">
                                            <i class="fas fa-envelope"></i>
                                        </div>
                                        <div class="contact-info">
                                            <h3 contenteditable="true">Ø§ÛŒÙ…ÛŒÙ„</h3>
                                            <p contenteditable="true">info@example.com</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="map-container">
                                    <div class="map-instructions">Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
                                    <div id="map-${sectionId}" style="height: 400px; background: var(--glass-bg); display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                                        <div style="text-align: center; color: var(--text-color);">
                                            <i class="fas fa-map" style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;"></i>
                                            <p>Ù†Ù‚Ø´Ù‡ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                                        </div>
                                    </div>
                                    <div class="map-controls">
                                        <input type="text" id="mapSearch-${sectionId}" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¢Ø¯Ø±Ø³...">
                                        <button data-section-id="${sectionId}">Ø¬Ø³ØªØ¬Ùˆ</button>
                                    </div>
                                </div>
                            </div>
                        </section>
                    `;
                    break;
            }
            
            // Add section to the page
            mainContainer.insertAdjacentHTML('beforeend', sectionHTML);
            
            // Add event listeners to the new section
            setTimeout(() => {
                const newSection = document.getElementById(sectionId);
                
                // Delete button
                const deleteBtn = newSection.querySelector('.delete-section');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function() {
                        deleteSection(sectionId);
                    });
                }
                
                // Add service button
                const addServiceBtn = newSection.querySelector('.add-service-btn');
                if (addServiceBtn) {
                    addServiceBtn.addEventListener('click', function() {
                        addServiceCard(sectionId);
                    });
                }
                
                // Add testimonial button
                const addTestimonialBtn = newSection.querySelector('.add-testimonial-btn');
                if (addTestimonialBtn) {
                    addTestimonialBtn.addEventListener('click', function() {
                        addTestimonialCard(sectionId);
                    });
                }
                
                // Add social button
                const addSocialBtn = newSection.querySelector('.add-social-btn');
                if (addSocialBtn) {
                    addSocialBtn.addEventListener('click', function() {
                        openSocialModal();
                    });
                }
                
                // Add gallery button
                const addGalleryBtn = newSection.querySelector('.add-gallery-item');
                if (addGalleryBtn) {
                    addGalleryBtn.addEventListener('click', function() {
                        galleryUpload.click();
                    });
                }
                
                // Add banking button
                const addBankingBtn = newSection.querySelector('.add-banking-btn');
                if (addBankingBtn) {
                    addBankingBtn.addEventListener('click', function() {
                        addBankCard(sectionId);
                    });
                }
                
                // Bank delete buttons
                const bankDeleteBtns = newSection.querySelectorAll('.bank-delete');
                bankDeleteBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        deleteBankCard(this);
                    });
                });
                
                // Bank number copy
                const bankNumbers = newSection.querySelectorAll('.bank-number');
                bankNumbers.forEach(number => {
                    number.addEventListener('click', function() {
                        copyToClipboard(this);
                    });
                });
                
                // About image upload
                if (type === 'about') {
                    const aboutImage = document.getElementById(`aboutImage-${sectionId}`);
                    aboutImage.addEventListener('click', function() {
                        aboutImageUpload.click();
                    });
                }
                
                // Map search button
                const mapSearchBtn = newSection.querySelector('.map-controls button');
                if (mapSearchBtn) {
                    mapSearchBtn.addEventListener('click', function() {
                        searchAddress(sectionId);
                    });
                }
            }, 100);
            
            // Add section to sections array
            sections.push({
                id: sectionId,
                type: type,
                title: '',
                content: ''
            });
            
            // Update navigation
            updateNavigation();
            
            showToast(`Ø¨Ø®Ø´ "${getSectionTypeName(type)}" Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`);
        }
        
        // Get section type name in Persian
        function getSectionTypeName(type) {
            const names = {
                'about': 'Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§',
                'services': 'Ø®Ø¯Ù…Ø§Øª',
                'testimonials': 'Ù†Ø¸Ø±Ø§Øª Ù…Ø´ØªØ±ÛŒØ§Ù†',
                'gallery': 'Ú¯Ø§Ù„Ø±ÛŒ ØªØµØ§ÙˆÛŒØ±',
                'social': 'Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ',
                'banking': 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ù†Ú©ÛŒ',
                'contact': 'ØªÙ…Ø§Ø³ Ùˆ Ù†Ù‚Ø´Ù‡'
            };
            
            return names[type] || type;
        }
        
        // Delete a section
        function deleteSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.remove();
                
                // Remove from sections array
                sections = sections.filter(section => section.id !== sectionId);
                
                // Update navigation
                updateNavigation();
                
                showToast('Ø¨Ø®Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯');
            }
        }
        
        // Add a service card
        function addServiceCard(sectionId) {
            const servicesGrid = document.querySelector(`#${sectionId} .services-grid`);
            const addButton = servicesGrid.querySelector('.add-service-btn');
            
            const serviceCard = document.createElement('div');
            serviceCard.className = 'service-card';
            serviceCard.innerHTML = `
                <h3 contenteditable="true">Ø®Ø¯Ù…Øª Ø¬Ø¯ÛŒØ¯</h3>
                <p contenteditable="true">ØªÙˆØ¶ÛŒØ­ Ù…Ø®ØªØµØ±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§ÛŒÙ† Ø®Ø¯Ù…Øª Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡ÛŒØ¯.</p>
            `;
            
            servicesGrid.insertBefore(serviceCard, addButton);
            showToast('Ø®Ø¯Ù…Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
        }
        
        // Add a testimonial card
        function addTestimonialCard(sectionId) {
            const testimonialsGrid = document.querySelector(`#${sectionId} .testimonials-grid`);
            const addButton = testimonialsGrid.querySelector('.add-testimonial-btn');
            
            const testimonialCard = document.createElement('div');
            testimonialCard.className = 'testimonial-card';
            testimonialCard.innerHTML = `
                <p contenteditable="true">"Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯ Ù…Ø´ØªØ±ÛŒ"</p>
                <div class="client" contenteditable="true">- Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</div>
            `;
            
            testimonialsGrid.insertBefore(testimonialCard, addButton);
            showToast('Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
        }
        
        // Add social media
        function addSocialMedia() {
            if (!currentSocialPlatform || !socialUsername.value) {
                showToast('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù¾Ù„ØªÙØ±Ù… Ùˆ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const socialSections = document.querySelectorAll('[data-section="social"]');
            if (socialSections.length === 0) {
                showToast('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø®Ø´ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const socialGrid = socialSections[0].querySelector('.social-grid');
            const addButton = socialGrid.querySelector('.add-social-btn');
            
            const socialCard = document.createElement('div');
            socialCard.className = 'social-card';
            socialCard.innerHTML = `
                <div class="social-icon">
                    <i class="fab fa-${currentSocialPlatform}"></i>
                </div>
                <div>
                    <div contenteditable="true">${getSocialPlatformName(currentSocialPlatform)}</div>
                    <div class="social-username">${socialUsername.value}</div>
                </div>
                <div class="social-delete">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            socialGrid.insertBefore(socialCard, addButton);
            
            // Add event listeners to the new social card
            const socialDeleteBtn = socialCard.querySelector('.social-delete');
            socialDeleteBtn.addEventListener('click', function() {
                deleteSocialCard(this);
            });
            
            closeSocialModal();
            showToast('Ø´Ø¨Ú©Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
        }
        
        // Get social platform name in Persian
        function getSocialPlatformName(platform) {
            const names = {
                'instagram': 'Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…',
                'telegram': 'ØªÙ„Ú¯Ø±Ø§Ù…',
                'whatsapp': 'ÙˆØ§ØªØ³Ø§Ù¾',
                'twitter': 'ØªÙˆÛŒÛŒØªØ±',
                'linkedin': 'Ù„ÛŒÙ†Ú©Ø¯ÛŒÙ†',
                'youtube': 'ÛŒÙˆØªÛŒÙˆØ¨'
            };
            
            return names[platform] || platform;
        }
        
        // Delete social media card
        function deleteSocialCard(element) {
            element.parentElement.remove();
            showToast('Ø´Ø¨Ú©Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯');
        }
        
        // Add bank card
        function addBankCard(sectionId) {
            const bankingGrid = document.querySelector(`#${sectionId} .banking-grid`);
            const addButton = bankingGrid.querySelector('.add-banking-btn');
            
            const bankingCard = document.createElement('div');
            bankingCard.className = 'banking-card';
            bankingCard.innerHTML = `
                <div class="bank-icon">
                    <i class="fas fa-university"></i>
                </div>
                <div class="bank-info">
                    <div contenteditable="true">Ù†Ø§Ù… Ø¨Ø§Ù†Ú©</div>
                    <div class="bank-number" contenteditable="true">Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨ ÛŒØ§ Ú©Ø§Ø±Øª</div>
                </div>
                <div class="bank-delete">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            bankingGrid.insertBefore(bankingCard, addButton);
            
            // Add event listeners to the new bank card
            const bankDeleteBtn = bankingCard.querySelector('.bank-delete');
            bankDeleteBtn.addEventListener('click', function() {
                deleteBankCard(this);
            });
            
            const bankNumber = bankingCard.querySelector('.bank-number');
            bankNumber.addEventListener('click', function() {
                copyToClipboard(this);
            });
            
            showToast('Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
        }
        
        // Delete bank card
        function deleteBankCard(element) {
            element.parentElement.remove();
            showToast('Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯');
        }
        
        // Copy to clipboard
        function copyToClipboard(element) {
            const text = element.innerText;
            navigator.clipboard.writeText(text).then(function() {
                // Show temporary feedback
                const originalText = element.innerText;
                element.innerText = 'Ú©Ù¾ÛŒ Ø´Ø¯!';
                setTimeout(() => {
                    element.innerText = originalText;
                }, 2000);
                showToast('Ù…ØªÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯');
            }).catch(function() {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ØªÙ†');
            });
        }
        
        // Update navigation menu
        function updateNavigation() {
            // Clear existing navigation items
            navContainer.innerHTML = '';
            
            // Add hero section to navigation
            const heroNavItem = document.createElement('div');
            heroNavItem.className = 'nav-item active';
            heroNavItem.textContent = 'ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ';
            heroNavItem.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                this.classList.add('active');
                
                // Highlight the section
                highlightSection('section-hero');
                
                document.getElementById('section-hero').scrollIntoView({ behavior: 'smooth' });
            });
            navContainer.appendChild(heroNavItem);
            
            // Add other sections to navigation
            document.querySelectorAll('.section').forEach(section => {
                const sectionId = section.id;
                const sectionTitle = section.querySelector('.section-title-text').textContent || 'Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯';
                
                const navItem = document.createElement('div');
                navItem.className = 'nav-item';
                navItem.textContent = sectionTitle;
                navItem.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Highlight the section
                    highlightSection(sectionId);
                    
                    section.scrollIntoView({ behavior: 'smooth' });
                });
                
                navContainer.appendChild(navItem);
            });
        }
        
        // Highlight a section for 3 seconds
        function highlightSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('highlighted');
                
                setTimeout(() => {
                    section.classList.remove('highlighted');
                }, 3000);
            }
        }
        
        // Initialize drag and drop with Sortable
        function initSortable() {
            // This is a simplified version - in a real implementation, you would use a library like SortableJS
            // For this example, we'll just add a basic drag and drop indicator
            const sections = document.querySelectorAll('.section, .hero-section');
            
            sections.forEach(section => {
                section.setAttribute('draggable', 'true');
                
                section.addEventListener('dragstart', function(e) {
                    this.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', this.id);
                });
                
                section.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
            });
            
            mainContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(mainContainer, e.clientY);
                const draggable = document.querySelector('.dragging');
                
                if (afterElement == null) {
                    mainContainer.appendChild(draggable);
                } else {
                    mainContainer.insertBefore(draggable, afterElement);
                }
                
                // Update navigation after reordering
                updateNavigation();
            });
        }
        
        // Helper function for drag and drop
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.section, .hero-section:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // Apply theme changes
        function applyTheme() {
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const buttonColor = document.getElementById('buttonColor').value;
            
            document.documentElement.style.setProperty('--primary-color', primaryColor);
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
            document.documentElement.style.setProperty('--button-color', buttonColor);
            
            // Save to localStorage
            localStorage.setItem('primaryColor', primaryColor);
            localStorage.setItem('secondaryColor', secondaryColor);
            localStorage.setItem('buttonColor', buttonColor);
            
            showToast('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¸Ø§Ù‡Ø±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯');
        }
        
        // Apply background image
        function applyBackgroundImage() {
            const fileInput = document.getElementById('bgImageUpload');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('heroBg').src = e.target.result;
                    
                    // Save to localStorage
                    localStorage.setItem('backgroundImage', e.target.result);
                    
                    showToast('ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯');
                };
                reader.readAsDataURL(file);
            } else {
                showToast('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ØªØµÙˆÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
            }
        }
        
        // Save data to localStorage
        function saveData() {
            const data = {
                businessName: document.getElementById('businessName').textContent,
                businessTagline: document.getElementById('businessTagline').textContent,
                businessLogo: businessLogo.src,
                primaryColor: document.getElementById('primaryColor').value,
                secondaryColor: document.getElementById('secondaryColor').value,
                buttonColor: document.getElementById('buttonColor').value,
                backgroundImage: document.getElementById('heroBg').src,
                textAlign: getComputedStyle(document.documentElement).getPropertyValue('--text-align').trim(),
                sections: []
            };
            
            // Save section data
            document.querySelectorAll('.section').forEach(section => {
                const sectionData = {
                    id: section.id,
                    type: section.getAttribute('data-section'),
                    title: section.querySelector('.section-title-text').textContent,
                    content: section.innerHTML
                };
                
                data.sections.push(sectionData);
            });
            
            // Create a download link
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
            const downloadAnchor = document.createElement('a');
            downloadAnchor.setAttribute("href", dataStr);
            downloadAnchor.setAttribute("download", "landing-page-data.json");
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            document.body.removeChild(downloadAnchor);
            
            // Also save to localStorage
            localStorage.setItem('landingPageData', JSON.stringify(data));
            
            showToast('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
        }
        
        // Save page as HTML
        function saveHTML() {
            // Create a clone of the document
            const htmlContent = document.documentElement.outerHTML;
            
            // Create a temporary DOM parser to remove CMS elements
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            
            // Remove CMS controls and related elements
            const elementsToRemove = [
                '.cms-toggle',
                '.cms-controls',
                '.add-section-main',
                '.section-modal',
                '.social-modal',
                '.toast'
            ];
            
            elementsToRemove.forEach(selector => {
                const elements = doc.querySelectorAll(selector);
                elements.forEach(el => el.remove());
            });
            
            // Remove contenteditable attributes
            const editableElements = doc.querySelectorAll('[contenteditable="true"]');
            editableElements.forEach(el => {
                el.removeAttribute('contenteditable');
            });
            
            // Remove delete buttons
            const deleteButtons = doc.querySelectorAll('.delete-section, .social-delete, .gallery-delete, .bank-delete');
            deleteButtons.forEach(btn => btn.remove());
            
            // Remove add buttons
            const addButtons = doc.querySelectorAll('.add-service-btn, .add-testimonial-btn, .add-social-btn, .add-gallery-item, .add-banking-btn');
            addButtons.forEach(btn => btn.remove());
            
            // Remove upload text
            const uploadTexts = doc.querySelectorAll('.logo-upload-text, .image-upload-text');
            uploadTexts.forEach(text => text.remove());
            
            // Remove map controls
            const mapControls = doc.querySelectorAll('.map-controls');
            mapControls.forEach(control => control.remove());
            
            // Remove map instructions
            const mapInstructions = doc.querySelectorAll('.map-instructions');
            mapInstructions.forEach(instruction => instruction.remove());
            
            // Fix CSS to remove right margin when CMS panel is removed
            const mainContainer = doc.querySelector('.main-container');
            if (mainContainer) {
                mainContainer.style.marginRight = '0';
                mainContainer.classList.remove('cms-open');
            }
            
            // Serialize the modified document back to a string
            const cleanHTML = '<!DOCTYPE html>\n' + doc.documentElement.outerHTML;
            
            // Create a Blob and download the file
            const blob = new Blob([cleanHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'landing-page.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('ØµÙØ­Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ ØµÙˆØ±Øª HTML Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
        }
        
        // Import data from file
        function importData() {
            const fileInput = document.getElementById('loadData');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        loadData(data);
                        showToast('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
                    } catch (error) {
                        showToast('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„');
                    }
                };
                reader.readAsText(file);
            } else {
                showToast('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙØ§ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
            }
        }
        
        // Load saved data
        function loadSavedData() {
            const savedData = localStorage.getItem('landingPageData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                loadData(data);
            }
        }
        
        // Load data into the page
        function loadData(data) {
            // Load basic info
            if (data.businessName) {
                document.getElementById('businessName').textContent = data.businessName;
            }
            
            if (data.businessTagline) {
                document.getElementById('businessTagline').textContent = data.businessTagline;
            }
            
            if (data.businessLogo) {
                businessLogo.src = data.businessLogo;
                navLogo.src = data.businessLogo;
                dynamicFavicon.href = data.businessLogo;
            }
            
            if (data.primaryColor) {
                document.getElementById('primaryColor').value = data.primaryColor;
                document.getElementById('primaryColorText').value = data.primaryColor;
                document.documentElement.style.setProperty('--primary-color', data.primaryColor);
            }
            
            if (data.secondaryColor) {
                document.getElementById('secondaryColor').value = data.secondaryColor;
                document.getElementById('secondaryColorText').value = data.secondaryColor;
                document.documentElement.style.setProperty('--secondary-color', data.secondaryColor);
            }
            
            if (data.buttonColor) {
                document.getElementById('buttonColor').value = data.buttonColor;
                document.getElementById('buttonColorText').value = data.buttonColor;
                document.documentElement.style.setProperty('--button-color', data.buttonColor);
            }
            
            if (data.backgroundImage) {
                document.getElementById('heroBg').src = data.backgroundImage;
            }
            
            if (data.textAlign) {
                document.documentElement.style.setProperty('--text-align', data.textAlign);
                document.querySelectorAll('.alignment-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('data-align') === data.textAlign) {
                        btn.classList.add('active');
                    }
                });
                
                // Update navigation layout
                updateNavLayout(data.textAlign);
            }
            
            // Load sections
            if (data.sections && data.sections.length > 0) {
                // Remove existing sections (except hero)
                document.querySelectorAll('.section').forEach(section => section.remove());
                
                // Add saved sections
                data.sections.forEach(sectionData => {
                    const sectionHTML = `
                        <section class="section" id="${sectionData.id}" data-section="${sectionData.type}">
                            ${sectionData.content}
                        </section>
                    `;
                    
                    mainContainer.insertAdjacentHTML('beforeend', sectionHTML);
                });
                
                // Update sections array
                sections = data.sections;
            }
            
            // Update navigation
            updateNavigation();
        }
        
        // Image compression function
        function compressImage(file, maxSizeKB, callback) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            
            reader.onload = function(event) {
                const img = new Image();
                img.src = event.target.result;
                
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Calculate new dimensions while maintaining aspect ratio
                    let width = img.width;
                    let height = img.height;
                    const maxDimension = 1200; // Maximum dimension for compression
                    
                    if (width > height && width > maxDimension) {
                        height = Math.round((height * maxDimension) / width);
                        width = maxDimension;
                    } else if (height > maxDimension) {
                        width = Math.round((width * maxDimension) / height);
                        height = maxDimension;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw image on canvas
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Get compressed data URL
                    let quality = 0.9;
                    let compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    
                    // Check if the compressed image is under the size limit
                    const sizeKB = Math.round((compressedDataUrl.length * 3) / 4 / 1024);
                    
                    // If still too large, reduce quality further
                    if (sizeKB > maxSizeKB) {
                        quality = maxSizeKB / sizeKB * 0.9;
                        compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    }
                    
                    callback(compressedDataUrl);
                };
            };
        }
        
        // Add image to gallery
        function addGalleryImage(imageSrc) {
            const gallerySections = document.querySelectorAll('[data-section="gallery"]');
            if (gallerySections.length === 0) return;
            
            const galleryGrid = gallerySections[0].querySelector('.gallery-grid');
            const addButton = galleryGrid.querySelector('.add-gallery-item');
            
            const galleryItem = document.createElement('div');
            galleryItem.className = 'gallery-item';
            galleryItem.innerHTML = `
                <img src="${imageSrc}" alt="ØªØµÙˆÛŒØ± Ú¯Ø§Ù„Ø±ÛŒ">
                <div class="gallery-delete">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            // Add event listeners to the new gallery item
            const galleryDeleteBtn = galleryItem.querySelector('.gallery-delete');
            galleryDeleteBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                deleteGalleryImage(this);
            });
            
            // Add click event to open lightbox
            galleryItem.addEventListener('click', function(e) {
                if (!e.target.classList.contains('gallery-delete') && !e.target.closest('.gallery-delete')) {
                    const index = galleryImages.findIndex(img => img.src === imageSrc);
                    if (index !== -1) {
                        openLightbox(index);
                    }
                }
            });
            
            galleryGrid.insertBefore(galleryItem, addButton);
            
            // Add to gallery images array
            galleryImages.push({ src: imageSrc, element: galleryItem });
        }
        
        // Delete gallery image
        function deleteGalleryImage(element) {
            const galleryItem = element.closest('.gallery-item');
            const imgSrc = galleryItem.querySelector('img').src;
            
            // Remove from array
            galleryImages = galleryImages.filter(img => img.src !== imgSrc);
            
            // Remove from DOM
            galleryItem.remove();
            
            showToast('ØªØµÙˆÛŒØ± Ø§Ø² Ú¯Ø§Ù„Ø±ÛŒ Ø­Ø°Ù Ø´Ø¯');
        }
        
        // Show toast notification
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Search address on map
        function searchAddress(sectionId) {
            const searchInput = document.getElementById(`mapSearch-${sectionId}`);
            const query = searchInput.value;
            
            if (!query) return;
            
            showToast('Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¢Ø¯Ø±Ø³: ' + query);
            // Note: For full functionality, you'd need to implement the map search
        }
    </script>
</body>
</html>
